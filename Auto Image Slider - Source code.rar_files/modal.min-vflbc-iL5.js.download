define(["require","exports","tslib","react","external/lodash","modules/clean/analytics","modules/clean/auth/login/form","modules/clean/auth/login_or_register/types","modules/clean/auth/register/form","modules/clean/auth_event_logger","modules/clean/growth/experiments/logger","modules/clean/react/comments2/data/logger","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/welcome_modal","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","spectrum/button","spectrum/modal"],(function(e,o,t,n,a,r,s,i,l,c,d,m,u,g,p,_,f,h,v,C,M,O){"use strict";var L;Object.defineProperty(o,"__esModule",{value:!0}),n=t.__importDefault(n),d=t.__importDefault(d),m=t.__importStar(m),f=t.__importStar(f);var b=((L={})[i.CommentTextVariant.DEFAULT]="default-variant",L[i.CommentTextVariant.POST]="post-comment-variant",L[i.CommentTextVariant.SUBSCRIBE]="subscribe-variant",L);o.TestOnlyCommentTextVariantCssClass=b,o.DefaultHeaderContent=function(e){var o=e.mode,t=e.onHeaderLinkClick,a=n.default.createElement(M.Button,{className:"button-as-link toggle-form-link",onClick:t,variant:"styleless"}),r=o===i.Mode.LOGIN?v._("Download and save directly to your Dropbox by signing in, or <a>create a free account</a>"):v._("Download and save to your Dropbox by creating a free account, or <a>sign in</a>");return n.default.createElement("span",null,p.reactFormat(r,{a:a}))};var D=function(e){var o,t=e.className,a=e.commentTextVariant,r=e.mode;switch(a){case i.CommentTextVariant.POST:o=r===i.Mode.LOGIN?v._("To post your comment, sign in to Dropbox."):v._("To post your comment, create a free Dropbox account.");break;case i.CommentTextVariant.SUBSCRIBE:o=r===i.Mode.LOGIN?v._("To subscribe to this file, sign in to Dropbox."):v._("To subscribe to this file, create a free Dropbox account.");break;default:o=r===i.Mode.LOGIN?v._("To continue, sign in to Dropbox."):v._("To continue, create a free Dropbox account.")}return n.default.createElement("div",{className:"text-variant "+t},o)};o.TestOnlyCommentsHeader=D;var E=function(e){var o=e.mode,t=e.onFooterLinkClick;return n.default.createElement(M.Button,{className:"button-as-link",onClick:t,variant:"styleless"},o===i.Mode.LOGIN?v._("New to Dropbox? Create a free account!"):v._("Have a Dropbox account? Sign in."))};o.DefaultFooterContent=function(e){var o=e.isDownload,t=e.onFooterLinkClick;return n.default.createElement(M.Button,{className:"button-as-link close-link",onClick:t,variant:"styleless"},o?v._("No thanks, continue to download"):v._("No thanks, continue to view"))};var N=(function(e){function u(t){var s=e.call(this,t)||this;return s.logWebActivityOnce=a.once((function(e){r.WebMiscActivityLogger.log(e,{auth_google:!0})})),s.logAuthIntent=function(){s.state.mode===i.Mode.LOGIN?c.AuthEventLogger.log_web_login_intent():c.AuthEventLogger.log_web_signup_intent()},s.renderHeader=function(){var e=s.props,t=e.commentParams,a=e.customHeaderContent,r=e.kind;if(a){var l=a;return n.default.createElement(l,{mode:s.state.mode,changeMode:s.toggleMode})}return n.default.createElement("div",{className:"mc-util-modal-header center"},r===i.LoginOrRegisterKind.COMMENT?n.default.createElement(D,{className:b[t.variant],commentTextVariant:t.variant,mode:s.state.mode}):n.default.createElement(o.DefaultHeaderContent,{mode:s.state.mode,onHeaderLinkClick:s.toggleMode}))},s.renderFooter=function(){var e=s.props,t=e.kind,a=e.customFooterContent,r=e.downloadAction;if(a){var l=a;return n.default.createElement(l,null)}return n.default.createElement("div",{className:"mc-util-modal-actions"},t===i.LoginOrRegisterKind.COMMENT?n.default.createElement(E,{mode:s.state.mode,onFooterLinkClick:s.toggleMode}):n.default.createElement(o.DefaultFooterContent,{isDownload:t===i.LoginOrRegisterKind.DOWNLOAD&&r===i.DownloadAction.DIRECT_DOWNLOAD,onFooterLinkClick:s.onContinueToView}))},s.toggleMode=function(e){e.preventDefault(),s.setState((function(e){if(s.props.kind===i.LoginOrRegisterKind.COMMENT){var o=e.mode===i.Mode.LOGIN?"sign_up_modal_toggle_to_sign_up":"sign_up_modal_toggle_to_sign_in";m.logEvent(o,{stream:s.props.commentParams.stream})}return{mode:e.mode===i.Mode.LOGIN?i.Mode.REGISTER:i.Mode.LOGIN}}),s.logAuthIntent)},s.onAuthenticateSuccess=function(e,o){var t=s.state.mode,a=s.props,r=a.downloadAction,l=a.kind;if(t===i.Mode.LOGIN?C.Notify.success(v._("Successfully signed in to Dropbox")):C.Notify.success(v._("Successfully signed up for Dropbox")),s.props.kind===i.LoginOrRegisterKind.COMMENT){var c=t===i.Mode.LOGIN?"sign_up_modal_sign_in_success":"sign_up_modal_sign_up_success";m.logEvent(c,{stream:s.props.commentParams.stream})}s.props.onAuthenticateSuccess(e),l===i.LoginOrRegisterKind.IMMEDIATE||r===i.DownloadAction.DIRECT_DOWNLOAD?t===i.Mode.REGISTER?(d.default.log("sharing","shared_link_welcome_modal_view"),g.Modal.showInstance(n.default.createElement(_.WelcomeModal,{id:"shared-link-welcome-modal",redirect_url:o.redirect_url}))):t===i.Mode.LOGIN&&f.reload():s.closeModal()},s.onContinueToView=function(e){e.preventDefault(),e.stopPropagation(),s.props.onContinueToView&&s.props.onContinueToView(),s.closeModal()},s.onCancel=function(e){e&&e.stopPropagation(),s.props.onCancel(),s.closeModal()},s.closeModal=function(e){e&&e.stopPropagation(),g.Modal.close(null)},s.state={mode:t.initialMode||i.Mode.LOGIN},h.assert(!(t.kind===i.LoginOrRegisterKind.COMMENT&&!t.commentParams),"Comment parameters must be provided if calling this modal from comments code"),s}return t.__extends(u,e),u.prototype.componentDidMount=function(){var e=this.props,o=e.downloadAction,t=e.kind;this.logAuthIntent(),t===i.LoginOrRegisterKind.IMMEDIATE?this.logWebActivityOnce("signup_modal-show-upfront"):t===i.LoginOrRegisterKind.DOWNLOAD&&o===i.DownloadAction.DIRECT_DOWNLOAD&&this.logWebActivityOnce("signup_modal-show-download")},u.prototype.render=function(){var e=this.state.mode,o=this.props,t=o.id,a=o.signup_tag;return n.default.createElement(O.Modal,{ariaLabel:"Login or register modal",appElement:document.body,bodyId:t,className:"mc-util-modal mc-util-modal-regular login-or-register-modal",displayCloseButton:!0,onRequestClose:this.onCancel,open:!0,overlayClassName:"file-viewer-modal-overlay",width:500},this.renderHeader(),n.default.createElement("div",{className:"mc-util-modal-body"},e===i.Mode.LOGIN&&n.default.createElement(s.LoginForm,{canRedirect:!1,className:"login-form-wrapper",googleLoginProps:{positionBelow:!1},showAppleLogin:this.props.showAppleLogin,appleLoginProps:{positionBelow:!1},maestroStyle:!0,onLoginSuccess:this.onAuthenticateSuccess,rememberMeCheckboxProps:{checked:!0},encryptionOptions:this.props.encryptionOptions}),e===i.Mode.REGISTER&&n.default.createElement(l.RegisterForm,{additionalParams:a?{signup_tag:a}:void 0,canRedirect:!1,className:"register-form-wrapper",maestroStyle:!0,onRegisterSuccess:this.onAuthenticateSuccess,tosCheckboxProps:{inline:!1}})),this.renderFooter())},u})(n.default.PureComponent);o.TestOnlyLoginOrRegisterModal=N;var w=u.requireCssWithComponent(N,["/static/css/components/login_or_register_modal-vflZjw7rU.css","/static/css/legacy_packages/components-vflmkI4mw.css","/static/css/components/button-vflQ0agva.css","/static/css/scooter/scooter-scoped-vflYtdnTb.css","/static/css/recaptcha_challenge-vflrcf67y.css","/static/css/recaptcha_v2_challenge-vfl5GXpO2.css"]);o.LoginOrRegisterModal=w}));
//# sourceMappingURL=modal.min.js-vfl1ZxX8j.map